<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>충남고등학교 제13회&#10;졸업50주년기념 초대장</title>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
 	  padding: 0;
	  height: 100%
      background: #000;
 	  touch-action: none; /* 제스처 직접 처리 */
    }
    .slider {
      display: flex;
	  flex-wrap: nowrap;
      //width: 400%;
      height: 100%;
      //transition: transform 0.3s ease;
      //touch-action: none;
    }
    .slide {
      flex: 0 0 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
	  background: #000;
    }
    .slide img {
      max-width: 100%;
      max-height: 100%;
      transform-origin: center center;
	  object-fit; 
      //transition: transform 0.05s ease-out;
    }
  </style>
</head>
<body>
  <div class="slider" id="slider">
    <div class="slide"><img src="page1.jpg" alt="이미지1"></div>
    <div class="slide"><img src="page2.jpg" alt="이미지2"></div>
    <div class="slide"><img src="page3.jpg" alt="이미지3"></div>
    <div class="slide"><img src="page4.jpg" alt="이미지4"></div>
  </div>

  <audio id="bgm" autoplay loop playsinline>
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <script>
    // --- 배경음악 ---
    const bgm = document.getElementById("bgm");
	bgm.volume = 0.2;
	
    document.addEventListener("DOMContentLoaded", () => {
      bgm.play().then(() => {
        bgm.volume = 0.2; // play() 성공 후 볼륨 조정
      }).catch(err => {
        console.log("음악 자동재생은 사용자 터치 후 동작할 수 있습니다.", err);
      });
    });

    // --- 슬라이드 ---
    const slider = document.getElementById("slider");
    const slides = slider.querySelectorAll(".slide img");
    let currentIndex = 0;
    let startX = 0;
    let currentX = 0;
    let isDragging = false;
    let isZooming = false; // 핀치줌 중 여부

    slider.addEventListener("touchstart", (e) => {
      if (e.touches.length === 1) {
        if (!isZooming) { // 줌 중이 아닐 때만 슬라이드 허용
          isDragging = true;
          startX = e.touches[0].clientX;
        }
      }
    });

    slider.addEventListener("touchmove", (e) => {
      if (isDragging && e.touches.length === 1 && !isZooming) {
        currentX = e.touches[0].clientX;
      }
    });

    slider.addEventListener("touchend", () => {
      if (!isDragging) return;
      let diff = currentX - startX;
      if (diff > 50 && currentIndex > 0) {
        currentIndex--;
      } else if (diff < -50 && currentIndex < slides.length - 1) {
        currentIndex++;
      }
      slider.style.transform = `translateX(-${currentIndex * 100}%)`;
      isDragging = false;
    });

    // --- 핀치 줌 ---
    function getDistance(touches) {
      const dx = touches[0].clientX - touches[1].clientX;
      const dy = touches[0].clientY - touches[1].clientY;
      return Math.sqrt(dx*dx + dy*dy);
    }

    slides.forEach(img => {
      let scale = 1;
      let lastDistance = 0;

      img.addEventListener("touchstart", (e) => {
        if (e.touches.length === 2) {
          isZooming = true;
          lastDistance = getDistance(e.touches);
        }
      }, { passive: false });

      img.addEventListener("touchmove", (e) => {
        if (e.touches.length === 2) {
          e.preventDefault();
          const newDistance = getDistance(e.touches);
          const delta = newDistance / lastDistance;
          scale *= delta;
          scale = Math.max(1, Math.min(scale, 5));
          img.style.transform = `scale(${scale})`;
          lastDistance = newDistance;
        }
      }, { passive: false });

      img.addEventListener("touchend", (e) => {
        if (e.touches.length < 2) {
          isZooming = false;
          if (scale < 1.05) {
            scale = 1;
            img.style.transform = "scale(1)";
          }
        }
      });
    });
  </script>
</body>
</html>